

## 重复代码

- 同一个类的两个函数含有相同的表达式：提炼函数，提炼出重复的代码，然后让这两个地点都调 用被提炼出来的那一段代码
- 重复代码只是相似而不是完全相同：请首先尝试用移动语句，重组代码顺序，把相似的部分放在一起以便提炼。
- 重复的代码段位于同一个超类的不同子类中：可以使用函数上移，来避免在两个子类之间互相调用。

## 过长函数

> 据我们的经验，活得最长、最好的程序，其中的函数都比较短，函数越长，就越难理解。

我们遵循这样一条原则：每当感觉需要以`注释`来说明点什么的时候，我们就把需要说明的东西写进一个`独立函数`中，并以其`用途`（而非实现手法）`命名`。我们可以对一组甚至`短短一行`代码做这件事。`哪怕替换后的函数调用动作比函数自身还长`，只要函数名称能够解释其用途，我们也该毫不犹豫地那么做。关键不在于函数的长度，而在于函数“做什么”和“如何做”之间的语义距离。


如果函数内有大量的参数和临时变量，它们会对你的函数提炼形成阻碍。如 果你尝试运用提炼函数（106），最终就会把许多参数传递给被提炼出来的新函 数，导致可读性几乎没有任何提升。此时，你可以经常运用以查询取代临时变量（178）来消除这些临时元素。引入参数对象（140）和保持对象完整（319）则 可以将过长的参数列表变得更简洁一些。

如果你已经这么做了，仍然有太多临时变量和参数，那就应该使出我们的杀 手锏——以命令取代函数（337）。

如何确定该提炼哪一段代码呢？一个很好的技巧是：寻找注释。它们通常能 指出代码用途和实现手法之间的语义距离。如果代码前方有一行注释，就是在提 醒你：可以将这段代码替换成一个函数，而且可以在注释的基础上给这个函数命名。就算只有一行代码，如果它需要以注释来说明，那也值得将它提炼到独立函 数中去。

条件表达式和循环常常也是提炼的信号。你可以使用分解条件表达式（260）处理条件表达式。对于庞大的 switch 语句，其中的每个分支都应该通过 提炼函数（106）变成独立的函数调用。如果有多个 switch 语句基于同一个条件 进行分支选择，就应该使用以多态取代条件表达式（272）。

至于循环，你应该将循环和循环内的代码提炼到一个独立的函数中。如果你 发现提炼出的循环很难命名，可能是因为其中做了几件不同的事。如果是这种情 况，请勇敢地使用拆分循环（227）将其拆分成各自独立的任务。

## 全局数据

全局数据印证了帕拉塞尔斯的格言：良药与毒药的区别在于剂量。有少量的 全局数据或许无妨，但数量越多，处理的难度就会指数上升。即便只是少量的数 据，我们也愿意将它封装起来，这是在软件演进过程中应对变化的关键所在


* 神秘命名
* 过长参数列表（Long Parameter List）
* 全局数据
* 发散式变化
* 霰弹式修改
* 依恋情结
* 数据泥团
*  基本类型偏执