## webpack 核心概念

- `Entry`：入口，`webpack` 从入口文件开始构建其`内部依赖图`

- `Output`：输出它所创建的 `bundles` 的输出路径，以及如何命名，默认值为 `./dist`。
- `Module`：`模块`，在 `Webpack` 里一切皆`模块`，一个模块对应着一个文件。
- `Chunk` ：代码块，一个 `Chunk` 由多个模块组合而成，用于代码合并与分割。
- `Loader`：`loader` 让 `webpack` 能够去处理那些`非 JavaScript` 文件（`webpack 自身只理解 JavaScript`）。
- `Plugin` ：执行如打包优化、压缩这样的，比 `loader` 执行范围更广的任务

## webpack 构建流程

`Webpack` 的运行流程是一个`串行`的过程，从启动到结束会依次执行以下流程 :

1. `初始化参数`：从`配置文件` (webpack.config.js) 和 `cli 命令行` 语句中读取与合并参数，得出最终的参数。
2. `开始编译`：用上一步得到的参数初始化 `Compiler` 对象，加载所有配置的插件，插件会监听 `webpack` 构建生命周期的事件，做出相应的反应，执行 `run()` 开始编译。
3. `确定入口`：根据配置中的 entry 找出所有的入口文件。
4. `编译模块`：从入口文件出发，解析文件构建 `AST 语法树`，`非js模块`调用对应的 `Loader` 进行翻译，再找出该模块的依赖，通过递归，直到入口和所有依赖都经过了处理。
5. `完成模块编译`：上一步结束后，可以得到被翻译后的模块，以及它们之间的依赖关系。
6. `输出资源`：根据`入口`和`模块之间的依赖关系`，组装成一个个包含多个模块的 `Chunk`。
7. `输出完成`：把 `chunk` 写入到文件系统。

在以上过程中，`Webpack` 会在特定的时间点广播出特定的事件，插件在监听到感兴趣的事件后会执行特定的逻辑，并且插件可以调用 `Webpack` 提供的 `API` 改变 `Webpack` 的运行结果。

## babel 的使用

这里要先着重说下用到的几个 `babel` 包：

- `@babel/parser`：用于将源码生成 `AST`
- `@babel/traverse`：对 `AST` 节点进行递归遍历
- `@babel/core` 和 `@babel/preset-env`：将 `AST` 语法树转换为 `code`(浏览器可执行代码)

`parser.js` 中主要就三个方法：

- `getAST`：将获取到的模块内容 解析成 `AST` 语法树
- `getDependencies`：遍历 `AST`，将用到的依赖收集起来
- `transform`：把获得的 `ES6` 的 `AST` 转化成 `ES5`

## 撸一个简易 webpack

### 定义 Compiler 类

```js
class Compiler {  
    constructor(options) {    
        // webpack 配置    
        const { entry, output } = options   
         // 入口    
        this.entry = entry    
        // 出口    
        this.output = output    
        // 模块    
        this.modules = []  
    }  
    // 构建启动  
    run() {}  
    // 重写 require 函数，输出 bundle  
    generate() {}
}
```

### 解析入口文件，获取 AST
我们这里使用@babel/parser，这是 babel7 的工具，来帮助我们分析内部的语法，包括 es6，返回一个 AST 抽象语法树。

