Vue 主要通过以下 4 个步骤来实现数据双向绑定的

- `实现一个监听器Observer`：对数据对象 `data` 进行遍历，包括子属性对象的属性，利用 `Object.defineProperty()` 对属性都加上 `setter` 和 `getter`。这样的话，给这个对象的某个值赋值，就会触发 `setter`，那么就能监听到了数据变化
- `实现一个解析器Compile`：解析 Vue 模板指令，将模板中的`变量`都替换成`数据`，然后初始化渲染页面视图，并将每个指令对应的节点绑定`更新函数`，添加监听数据的`订阅者Watcher`，一旦数据有变动，收到通知，调用`更新函数`进行数据更新
  - 解析 `vue` 模板，把`模板变量`替换成数据 (每个`模板变量`都被绑定了`更新函数`)：`{{text}} --> 123`
  - 每个`模板变量`都被添加了一个`Watcher`监听
- `实现一个订阅者Watcher`：`Watcher` 订阅者是 `Observer` 和 `Compile` 之间通信的桥梁，主要的任务是订阅 `Observer` 中的属性值变化的消息，当收到属性值变化的消息时，触发解析器 `Compile` 中对应的`更新函数`
- `实现一个订阅器Dep`：订阅器采用 发布 - 订阅 设计模式，用来收集订阅者 `Watcher`，对监听器 `Observer` 和 订阅者 `Watcher `进行统一管理

![](https://chao31.github.io/pics/img/202304031711037.png)

## 实现双向绑定

我们还是以 Vue 为例，先来看看 Vue 中的双向绑定流程是什么的

new Vue() 首先执行初始化，对 data 执行响应化处理，这个过程发生 Observe 中
同时对模板执行编译，找到其中动态绑定的数据，从 data 中获取并初始化视图，这个过程发生在 Compile 中
同时定义⼀个更新函数和 Watcher，将来对应数据变化时 Watcher 会调用更新函数
由于 data 的某个 key 在⼀个视图中可能出现多次，所以每个 key 都需要⼀个管家 Dep 来管理多个 Watcher
将来 data 中数据⼀旦发生变化，会首先找到对应的 Dep，通知所有 Watcher 执行更新函数