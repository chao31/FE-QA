## 相同点


Tree diff 的优化

- 只比较同一层级，不跨级比较
- tag 不同则删掉重建（不在去比较内部细节）
- 子节点通过 key 区分

## 不同点

1. `vue2` 的 `diff` 算法过程：
- 只会进行`同层比较`，时间复杂度从`O(n^3) -> O(n)`
- 首先判断`新、旧节点`是否值得对比（根据 `key` 和 `tag` 标签名判断，是否是`同类节点`）
  - `不值得`对比：删除旧节点，插入新节点
  - `值得`对比：若是`文本节点`，则更新文本内容；若是`元素节点`，则更新元素属性；
- 再来看`新、旧节点`的`子节点`
  - 若旧节点`没有`子节点，而新节点`有`，则`新建`子节点并插入；
  - 若旧节点`有子节点`，而新节点`没有`，则`删除`全部`子节点`；
  - 若新、旧节点`都有`子节点，则调用 `updateChildren` 进行下一步的比较，这也是 `diff` 算法的精髓：用`4 个指针`分别指向新、旧节点的`头部`和`尾部`
    - 若旧头 === 新头，则指针后移
    - 若旧尾 === 新尾，则指针前移
    - 若旧头 === 新尾，则指针往中间靠
    - 若旧尾 === 新头，则指针往中间靠
    - 新头逐个去查找（若找到了，将该节点移动到已处理过的节点后；若没找到，新建节点并移动到已处理过的节点后）
2. `vue3`的 diff 算法优化：使用`最长递增子序列`可以最大程度的减少 DOM 的移动，达到最少的 DOM 操作
   - 头和头比
   - 尾和尾比
   - 基于`最长递增子序列`进行`移动/添加/删除`
     - 找到新节点中`还未比较过`的节点 (新头和新尾指针中间的节点)
     - 找到它们对应的下标，如`[ 5, 2, 3, 4, -1 ]`，`-1` 是老数组里没有的即`新增`
     - 找到最长递增子序列`[ 2, 3, 4 ]`，剩余节点基于它`移动/新增/删除`